# webpack使用实践

## webpack-app

```bash
npx create-react-app webpack-app
```

根目录说明

```bash
├── README.md           # 说明文档，该文档非常丰富，建议由时间阅读
├── config              # 配置文件夹
├── node_modules        # node 依赖文件夹，基本不用管
├── package-lock.json   # 包锁定文件，不用管。
├── package.json        # 配置文件，有些内容在此配置
├── public              # 静态资源目录、入口文件目录
├── scripts             # npm 脚本文件夹，不用管
└── src                 # 开发目录
```

src 开发目录说明

开发目录默认文件如下

```bash
├── App.css                     # 删除
├── App.js                      # 删除
├── App.test.js                 # 删除
├── index.css                   # 删除
├── index.js                    # 入口文件
├── logo.svg                    # 删除
└── registerServiceWorker.js    # 注册服务文件，留着就好
```

public 静态文件目录说明

```bash
├── favicon.ico         # 标签栏图标文件，找设计做一个替换
├── index.html          # 入口 index.html 文件
└── manifest.json       # 配置参数，不理它 
```



## webpack功能

- 代码转换：TypeScript编译成JavaScript、SCSS编译成CSS等。
- 文件优化：压缩JavaScript、CSS、HTML代码，压缩合成图片等。
- 代码分割：提取多个页面的公共代码、提取首屏不需要执行部分的代码让其异步加载。
- 模块合并：在采用模块化的项目里会有很多个模块和文件，需要构建功能把模块分类合并成一个文件。
- 自动刷新：舰艇本地源代码的变化，自动重新构建、刷新浏览器。
- 代码校验：在代码被提交到仓库前需要校验代码是否符合规范，以及单元测试是否通过。
- 自动发布：更新完代码后，自动构建出线上发布代码并传输给发布系统。

## 什么是webpack

1. webpack是一个模块打包器（bundler）
2. 在webpack看来，前端所有资源文件（js/json/css/img/less/...）都会作为模块处理
3. 它将根据模块的依赖关系进行静态分析，生成对应的静态资源

## 五个核心概念

1. Entry：入口起点（entry point）指示webpack应该使用那个模块，用来作为构建内部依赖图的开始
2. Output：output告诉webpack在哪里输出它所创建的bundles，以及如何命名这些文件，默认值为./dist
3. Loader：loader让webpack能够去处理那些非javascript文件（webpack自身只能解析JavaScript）
4. Plugins：插件则可以用于执行范围更广的任务。插件的任务包括，从打包优化和压缩，一直到重新定义环境中的变量等
5. Mode：模式，有生产模式production和开发模式development

## Loader

1. webpack本身只能加载JS/JSON模块，如果需要加载其他类型的文件（模块），就需要使用对应的loader进行转换/加载
2. Loader本身也是运行在node.js环境中的JavaScript模块
3. 它本身是一个函数，接受源文件作为参数，返回转换的结果
4. loader一般已xxx-loader的方式命名，xxx代表了这个loader要做的转换功能，比如json-loader

- 初始化项目

  ```json
  // 修改package.json文件
  {
    "name": "webpack-app",
    "version": "1.0.0"
  }
  ```

## webpack.config.js

```bash
webpack src/index.js -o dist/index.js --mode development # 未使用配置文件
# webpack能够编译打包js/json文件，并且能够将es6的模块化语法转换成浏览器能够识别的语法
```

### 安装webpack、webpack-cli

```bash
npm install webpack webpack-cli -g # 全局安装，作为指令使用
npm install webpack webpack-cli -D # 本地安装，作为本地依赖使用
```

在根目录中创建webpack.config.js文件

```javascript
var path = require('path'); // 设置路径

module.exports = {
  entry: './src/index.js', // 入口文件配置（简写）
  /*
  完成写法
  entry:{
  	main:'./src/index.js'
  }
  */
  output: { // 输出配置
    path: path.resolve(__dirname, 'dist'), // 输出文件路径配置
    filename: 'index.js' //输出文件名
  },
  mode: 'development', // 开发环境（二选一）自己开发时候用，编译成浏览器识别的语言
  mode: 'production', // 生产环境（二选一）部署的时候用，编译成es5语言
};
```

## 打包less资源

- 概述：less文件webpack不能解析，需要借助loader编译解析

- 安装loader

  ```bash
  npm install css-loader style-loader less-loader less --save-dev
  ```

- 配置loader

  ```json
  module.exports = {
    ...
    // 所有的loader都要在module对象中的rules属性中
    // rules是一个数组，数组中每一个对象就是一个loader
    module: {
      rules: [
        {
          test: /\.less$/, // 检查文件是否以.less结尾（检查是否是less文件）
          use: [
            'style-loader', // 数组中loader执行是从上到下，从右到左顺序执行
            'css-loader', // 创建style标签，添加上js中的css代码
            'less-loader' // 将less文件解析成css文件
          ]
        }
      ]
    }
  };
  ```

  

## js语法检查

- 概述：对js基本语法错误/隐患，进行提前检查

- 安装loader

  ```bash
  npm install eslint-loader eslint --save-dev
  ```

- 配置loader

  ```json
  module.exports = {
    ...
    // 所有的loader都要在module对象中的rules属性中
    // rules是一个数组，数组中每一个对象就是一个loader
    module: {
      rules: [
        {
          test: /\.js$/, // 检查文件是否以.js结尾（检查是否是js文件）
          exclude: /node_modules/, // 排除node_modules文件夹
          enforce: "pre", // 提前加载使用
          use: [
            loader: "eslint-loader" // js语法检测
          ]
        }
      ]
    }
  };
  ```

- 修改package.json （记得删除注释）

  ```json
  "eslintConfig": {
  	"parserOption": {
      "ecmaVersion": 6, // 支持es6
      "sourceType": "module" // 使用es6模块化
    },
    "env": { // 设置环境
      "brower": true, // 支持浏览器环境：能够使用window上的全局变量
      "node": true // 支持服务器环境：能够使用node上的global的全局变量
    },
    "globals": { // 声明使用的全局变量，这样即使没有定义也不会再报错了
      "$": "readonly" // $ 只读变量
    },
    "rules": { // eslint检查的规则 0 忽略 1 警告 2 错误
      "no-console": 0,  // 不检查console
      "eqeqeq": 2, // 用==而不用===就报错
      "no-alert": 2 // 不能使用alert
    },
    "extends": "eslint:recommended" // 使用eslint推荐的默认规则 https://cn.eslint.org/docs/rules/
  },
  ```

  